<div class="flex flex-col w-full space-y-5">
  <p-toast></p-toast>
  <p-confirmDialog [style]="{width: '50vw'}" header="Confirmation" icon="pi pi-exclamation-triangle"
                   rejectButtonStyleClass="p-button-outlined"></p-confirmDialog>

  <div class="flex flex-row-reverse justify-between m-5">
    <button type="button" (click)="show()" class="p-3 border border-gray-200 rounded-full">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 512 512">
        <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"
              d="M256 112v288m144-144H112"/>
      </svg>
    </button>
    <div
      class="flex flex-row space-x-3 px-4 py-2.5 rounded-xl text-sm text-gray-600 outline-none border border-gray-300 focus:border-cyan-300 transition">
      <small>Résultat par page : </small>
      <select class="" [(ngModel)]="itemsPerPage" id="itemsPerPage" name="itemsPerPage">
        <option>5</option>
        <option>10</option>
        <option>20</option>
      </select>
    </div>
  </div>

  <div *ngIf="!reservations" class="flex items-center justify-center w-full">
    <p-progressSpinner></p-progressSpinner>
  </div>

  <div *ngIf="reservations" class="m-5 overflow-hidden border border-gray-200 rounded-lg shadow-md">
    <table class="w-full text-sm text-left text-gray-500 bg-white border-collapse">
      <thead class="bg-gray-50">
      <tr>
        <th scope="col" class="px-6 py-4 font-medium text-gray-900">Client</th>
        <th scope="col" class="px-6 py-4 font-medium text-gray-900">Site</th>
        <th scope="col" class="px-6 py-4 font-medium text-gray-900">Nb pers.</th>
        <th scope="col" class="px-6 py-4 font-medium text-gray-900">Prix</th>
        <th scope="col" class="px-6 py-4 font-medium text-gray-900">date départ</th>
        <th scope="col" class="px-6 py-4 font-medium text-gray-900">Status</th>
        <th scope="col" class="px-6 py-4 font-medium text-gray-900"></th>
      </tr>
      </thead>

      <tbody class="border-t border-gray-100 divide-y divide-gray-100">
      <tr class="hover:bg-gray-50" *ngFor="let reservation of reservations | filter : navigationService.currentSearchText : 'user':'full_name' | paginate: {
                                                      itemsPerPage: itemsPerPage,
                                                      currentPage: p,
                                                      totalItems: reservations.length }
                                                       ">
        <th class="flex gap-3 px-6 py-4 font-normal text-gray-900 cursor-pointer" (click)="show(reservation,'update')">
          <div class="relative w-10 h-10">
            <img
              class="object-cover object-center w-full h-full rounded-full"
              src="{{reservation.user.profile_picture??'assets/user.png'}}"
              alt="{{reservation.user.full_name}}"
            />
          </div>
          <div class="text-sm">
            <div class="font-medium text-gray-700">{{reservation.user.full_name}}</div>
            <div class="text-gray-400">{{reservation.user.email}}</div>
          </div>
        </th>
        <td class="px-6 py-4">{{reservation.site.name}}</td>
        <td class="px-6 py-4">{{reservation.nb_personnes}}</td>
        <td class="px-6 py-4">{{reservation.price| currency:'XAF'}}</td>
        <td class="px-6 py-4">{{reservation.site_date.date_|date:'dd-MM-YY'}}</td>
        <td class="px-6 py-4">
          <div class="flex gap-2">
            <span
              [ngClass]="getClass(reservation.status)"
              class="inline-flex items-center gap-1 px-2 py-1 text-xs font-semibold text-blue-600 rounded-full bg-blue-50">
              {{reservation.status}}
            </span>
          </div>
        </td>
        <td class="px-6 py-4">
          <div class="flex justify-end gap-4">
            <button pButton (click)="onValidateReservation(reservation)" pRipple type="button" icon="pi pi-check" class="p-button-rounded p-button-success p-button-text"></button>
            <button pButton (click)="onRefuseReservation(reservation)" pRipple type="button" icon="pi pi-times" class="p-button-rounded p-button-danger p-button-text"></button>
            <button pButton (click)="onCancelReservation(reservation)" pRipple type="button" icon="pi pi-ban" class="p-button-rounded p-button-warning p-button-text"></button>
            <button pButton (click)="show(reservation,'update')" pRipple type="button" icon="pi pi-pencil" class="p-button-rounded p-button-info p-button-text"></button>
          </div>
        </td>
      </tr>
      </tbody>
    </table>

    <div  class="flex items-center justify-center ">
      <pagination-controls (pageChange)="p = $event" previousLabel="Precedent"
                           nextLabel="Suivant"></pagination-controls>
    </div>
  </div>
</div>
